import{l as s,a as I,i as S,g as x,b as k,f as z,c as B,p as L}from"./postCliente.DVX4mV6T.js";import"./Header.astro_astro_type_script_index_0_lang.zt7_kcih.js";function G(e,a){let i="https://wa.me/";i+=a,i+="?text=",e=e.replace(/ /g,"%20"),i+=e,window.open(i)}let n;const p=document.getElementById("overlay"),E=document.getElementById("precios"),P=document.getElementById("modalPrecioClose"),A=E.querySelector("p"),D=document.getElementById("confirmar"),t=new s.Map("map",{tap:!1,center:[-17.784071,-63.180522],zoom:12,zoomControl:!0}),O=s.tileLayer("https://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),R=s.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),q={OpenStreetMap:O,"Esri World Imagery":R};t.getContainer().style.cursor="crosshair";s.control.layers(q,{},{position:"topleft",collapsed:!1}).addTo(t);s.control.custom({position:"bottomcenter",content:`<div>
                    <button id="cotiza" class="btn btn-secondary btn-disabled sombra text-white">
                    COTIZA
                    </button>
                  </div>`,classes:"pb-1",events:{click:$}}).addTo(t);const T=document.getElementById("cotiza");function U(e){const a=document.querySelector("nav");a&&!a.contains(e.originalEvent.target)&&(n?t.removeLayer(n):T.classList.remove("btn-disabled"),n=new s.Marker(e.latlng,{icon:S}).addTo(t),console.log("Lat: "+e.latlng.lat.toFixed(6)+", Lon: "+e.latlng.lng.toFixed(6)))}t.on("click",U);const _=s.control.locate(I);_.addTo(t);t.on("locationfound",function(e){const a=e.latlng.lat,i=e.latlng.lng;console.log("Lat: "+a+", Lon: "+i),n?t.removeLayer(n):T.classList.remove("btn-disabled"),n=new s.Marker(e.latlng,{icon:S}).addTo(t),t.flyTo(e.latlng,19)});t.on("locationerror",function(e){alert(e.message)});let M,g,b,C;async function $(){let e,a,i,d,m,u,f,r;p.classList.remove("invisible");let v=await x().then(o=>{let l=[];return o&&o.forEach(c=>{k(n,c.polygon)&&l.push(c.factor)}),l});if(v.length===0)return p.classList.add("invisible"),alert("No se encontraron factores"),null;e=v.reduce((o,l)=>o*l,1),console.log("Factor: "+e),{paths:M,distancias:g,tiempos:b,origenes:C}=await z(n,.15),console.log("origenes:",C),console.log("tiempos:",b),console.log("distancias:",g),M.forEach(o=>o.addTo(t));const h=g.reduce((o,l,c,y)=>l<y[o]?c:o,0);console.log("Distancia Menor:",C[h]),a=await B(),i=g[h]*a.p_km,console.log("precioDistancia:",i),d=b[h]*a.p_tiempo,console.log("precioTiempo:",d),m=a.p_base,console.log("precioBase:",m),u=m+(i<d?d:i),console.log("precioFinal:",u),f=u*e,console.log("precioFinalFactor:",f),r=Math.round(f/10)*10,console.log("precioFinalRedondeado:",r),A.innerHTML=`Costo base para vivienda <br> Bs. ${r}`,E.showModal();async function w(){p.classList.add("invisible"),await L("Cliente","",r,n,"COT","CLX").then(()=>{console.log("Cancelado - Cliente guardado")})}async function F(){p.classList.add("invisible");let o=r.toString(10).split("");o.unshift(Math.floor(Math.random()*10).toString()),o.splice(2,0,Math.floor(Math.random()*10).toString()),o.splice(4,0,Math.floor(Math.random()*10).toString()),o.splice(6,0,Math.floor(Math.random()*10).toString());let l=o[0]+o[1]+o[2]+o[3]+o[4]+o[5]+o[6],c="+59167728817";await L("Cliente","",r,n,"COT","CLC",l).then(()=>{console.log("Confirmado - Cliente guardado")});let y=`Código de cotización:${l}%0D%0A
          ¡Hola!, Requiero el servicio de limpieza en la siguiente ubicación:%0D%0A
          https://maps.google.com/maps?q=${n.getLatLng().lat.toFixed(7)}%2C${n.getLatLng().lng.toFixed(7)}&z=17&hl=es`;G(y,c)}P.onclick=w,D.onclick=F}
